name: Daily Reddit Bot

on:
  schedule:
    # æ¯å¤©åŒ—äº¬æ—¶é—´ 09:00 è¿è¡Œ (UTC 01:00)
    - cron: '0 1 * * *'
  workflow_dispatch:  # æ”¯æŒæ‰‹åŠ¨è§¦å‘æµ‹è¯•

jobs:
  run-reddit-bot:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          echo "âœ… ä¾èµ–å®‰è£…å®Œæˆ"
      
      - name: Verify environment variables
        run: |
          echo "ğŸ” æ£€æŸ¥ç¯å¢ƒå˜é‡..."
          if [ -z "$TELEGRAM_BOT_TOKEN" ]; then
            echo "âŒ TELEGRAM_BOT_TOKEN æœªè®¾ç½®"
            exit 1
          fi
          if [ -z "$CHAT_ID" ]; then
            echo "âŒ CHAT_ID æœªè®¾ç½®"
            exit 1
          fi
          echo "âœ… ç¯å¢ƒå˜é‡æ£€æŸ¥é€šè¿‡"
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          CHAT_ID: ${{ secrets.CHAT_ID }}
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
      
      - name: Run simple test
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          CHAT_ID: ${{ secrets.CHAT_ID }}
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        run: |
          echo "ğŸ§ª è¿è¡Œç®€åŒ–æµ‹è¯•..."
          python test_simple.py
      
      - name: Run Simple Reddit Bot
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          CHAT_ID: ${{ secrets.CHAT_ID }}
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        run: |
          echo "ğŸš€ å¼€å§‹è¿è¡Œæç®€ç‰ˆ Reddit Bot..."
          python main_simple.py
          echo "âœ… æç®€ç‰ˆ Reddit Bot è¿è¡Œå®Œæˆ"
      
      - name: Notify on failure
        if: failure()
        run: |
          echo "âŒ Reddit Bot æ‰§è¡Œå¤±è´¥"
          echo "è¯·æ£€æŸ¥ä»¥ä¸‹é¡¹ç›®:"
          echo "1. GitHub Secrets æ˜¯å¦æ­£ç¡®é…ç½®"
          echo "2. Telegram Bot Token æ˜¯å¦æœ‰æ•ˆ"
          echo "3. Chat ID æ˜¯å¦æ­£ç¡®"
          echo "4. Gemini API Key æ˜¯å¦æœ‰æ•ˆ"
          echo "5. Reddit API æ˜¯å¦å¯è®¿é—®"
